<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Create Modal Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-title { color: #333; border-bottom: 2px solid #4f46e5; padding-bottom: 10px; }
        .test-step { background: #f8fafc; padding: 15px; margin: 10px 0; border-left: 4px solid #4f46e5; }
        .status { padding: 5px 10px; border-radius: 4px; color: white; font-weight: bold; }
        .pending { background: #f59e0b; }
        .in-progress { background: #3b82f6; }
        .passed { background: #10b981; }
        .failed { background: #ef4444; }
        .validation-form { background: #fafafa; padding: 15px; border: 1px solid #e5e7eb; border-radius: 6px; margin: 10px 0; }
        .form-field { margin: 10px 0; }
        .form-field label { display: block; font-weight: bold; margin-bottom: 5px; }
        .form-field input, .form-field select { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; }
        .button { padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #4338ca; }
        .button.secondary { background: #6b7280; }
        .error-msg { color: #ef4444; font-size: 0.875rem; margin-top: 5px; }
        .success-msg { color: #10b981; font-size: 0.875rem; margin-top: 5px; }
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; margin: 10px 0; }
        .progress-fill { height: 100%; background: #4f46e5; border-radius: 4px; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">User Create Modal - Functional Validation Test Suite</h1>
        <p><strong>Test Target:</strong> http://192.168.1.137:5175 (Admin System)</p>
        <p><strong>Test Credentials:</strong> admin@mestocker.com / Admin123456</p>
        <p><strong>Test Scope:</strong> Complete User Create Modal functionality validation</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        <p id="progress-text">Ready to start testing...</p>
    </div>

    <div class="test-container">
        <h2 class="test-title">Test 1: Modal Opening Functionality</h2>
        <div class="test-step">
            <h3>Objective:</h3>
            <p>Verify that the User Create Modal opens correctly when clicking the "Create User" button</p>

            <h3>Test Steps:</h3>
            <ol>
                <li>Navigate to http://192.168.1.137:5175</li>
                <li>Login with admin credentials</li>
                <li>Navigate to User Management section</li>
                <li>Click "Create User" button</li>
                <li>Verify modal opens with proper structure</li>
            </ol>

            <h3>Expected Results:</h3>
            <ul>
                <li>Modal appears with overlay background</li>
                <li>Modal has proper header with title "Create New User"</li>
                <li>Progress indicator shows "Step 1 of 3: Basic Information"</li>
                <li>Form fields are visible and accessible</li>
                <li>Close button (X) is present and functional</li>
            </ul>

            <div id="test1-status" class="status pending">PENDING</div>
            <div id="test1-result"></div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Test 2: Form Fields Validation</h2>
        <div class="test-step">
            <h3>Simulate Form Field Testing:</h3>

            <div class="validation-form">
                <h4>Step 1: Basic Information Fields</h4>
                <div class="form-field">
                    <label>Email Address *</label>
                    <input type="email" id="test-email" placeholder="user@example.com">
                    <div id="email-error" class="error-msg" style="display: none;"></div>
                </div>
                <div class="form-field">
                    <label>First Name *</label>
                    <input type="text" id="test-firstname" placeholder="First Name">
                    <div id="firstname-error" class="error-msg" style="display: none;"></div>
                </div>
                <div class="form-field">
                    <label>Last Name *</label>
                    <input type="text" id="test-lastname" placeholder="Last Name">
                    <div id="lastname-error" class="error-msg" style="display: none;"></div>
                </div>
                <div class="form-field">
                    <label>Password *</label>
                    <input type="password" id="test-password" placeholder="Password">
                    <div id="password-error" class="error-msg" style="display: none;"></div>
                    <div class="success-msg" style="font-size: 0.75rem;">Must be at least 8 characters with uppercase, lowercase, and number</div>
                </div>
                <div class="form-field">
                    <label>Confirm Password *</label>
                    <input type="password" id="test-confirm-password" placeholder="Confirm Password">
                    <div id="confirm-password-error" class="error-msg" style="display: none;"></div>
                </div>
                <button class="button" onclick="validateBasicInfo()">Validate Basic Info</button>
            </div>

            <div class="validation-form" style="margin-top: 20px;">
                <h4>Step 2: Additional Details Fields</h4>
                <div class="form-field">
                    <label>Phone Number</label>
                    <input type="tel" id="test-phone" placeholder="+1 (555) 123-4567">
                    <div id="phone-error" class="error-msg" style="display: none;"></div>
                </div>
                <div class="form-field">
                    <label>Document/ID Number</label>
                    <input type="text" id="test-document" placeholder="ID, Passport, or Tax ID">
                    <div id="document-error" class="error-msg" style="display: none;"></div>
                </div>
                <button class="button" onclick="validateAdditionalDetails()">Validate Additional Details</button>
            </div>

            <div class="validation-form" style="margin-top: 20px;">
                <h4>Step 3: Security Settings</h4>
                <div class="form-field">
                    <label>User Type *</label>
                    <select id="test-usertype">
                        <option value="BUYER">üõí Buyer - Customer account</option>
                        <option value="VENDOR">üè™ Vendor - Seller account</option>
                        <option value="ADMIN">‚öô Admin - Administrator account</option>
                        <option value="SUPERUSER">üëë Superuser - Full system access</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>Security Clearance Level *</label>
                    <select id="test-security-level">
                        <option value="1">Level 1 - Standard</option>
                        <option value="2">Level 2 - Standard+</option>
                        <option value="3">Level 3 - Medium</option>
                        <option value="4">Level 4 - Medium+</option>
                        <option value="5">Level 5 - High</option>
                        <option value="6">Level 6 - High+</option>
                        <option value="7">Level 7 - Critical</option>
                    </select>
                </div>
                <button class="button" onclick="validateSecuritySettings()">Validate Security Settings</button>
            </div>

            <div id="test2-status" class="status pending">PENDING</div>
            <div id="test2-result"></div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Test 3: Form Validation Rules</h2>
        <div class="test-step">
            <h3>Validation Rule Tests:</h3>
            <div id="validation-tests">
                <button class="button" onclick="testEmailValidation()">Test Email Validation</button>
                <button class="button" onclick="testPasswordValidation()">Test Password Rules</button>
                <button class="button" onclick="testRequiredFields()">Test Required Fields</button>
                <button class="button" onclick="testPhoneValidation()">Test Phone Format</button>
            </div>
            <div id="validation-results" style="margin-top: 15px;"></div>

            <div id="test3-status" class="status pending">PENDING</div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Test 4: Complete User Creation Flow</h2>
        <div class="test-step">
            <h3>End-to-End User Creation Test:</h3>
            <div id="user-creation-test">
                <h4>Test Users to Create:</h4>
                <div class="validation-form">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="button" onclick="createTestUser('BUYER')">Create Test BUYER</button>
                        <button class="button" onclick="createTestUser('VENDOR')">Create Test VENDOR</button>
                        <button class="button" onclick="createTestUser('ADMIN')">Create Test ADMIN</button>
                    </div>
                </div>
                <div id="creation-results" style="margin-top: 15px;"></div>
            </div>

            <div id="test4-status" class="status pending">PENDING</div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Test Summary & Manual Instructions</h2>
        <div class="test-step">
            <h3>Manual Testing Checklist (To perform in actual browser):</h3>
            <ol>
                <li><strong>Navigate to Admin System:</strong> http://192.168.1.137:5175</li>
                <li><strong>Login:</strong> admin@mestocker.com / Admin123456</li>
                <li><strong>Access User Management:</strong> Navigate to user management section</li>
                <li><strong>Test Modal Opening:</strong> Click "Create User" button, verify modal opens</li>
                <li><strong>Test Step Navigation:</strong> Progress through all 3 steps (Basic ‚Üí Details ‚Üí Security)</li>
                <li><strong>Test Form Validation:</strong> Submit with empty/invalid data, verify error messages</li>
                <li><strong>Test User Creation:</strong> Create users with different types and verify success</li>
                <li><strong>Verify Data Persistence:</strong> Check if created users appear in User Data Table</li>
                <li><strong>Test Modal Closing:</strong> Verify modal closes after successful creation</li>
                <li><strong>Test Error Handling:</strong> Try creating duplicate users, verify error handling</li>
            </ol>

            <h3>Critical Validation Points:</h3>
            <ul>
                <li>‚úÖ Modal structure and layout</li>
                <li>‚úÖ Multi-step form progression</li>
                <li>‚úÖ Form field validation</li>
                <li>‚úÖ Password security requirements</li>
                <li>‚úÖ User type selection functionality</li>
                <li>‚úÖ Security clearance level assignment</li>
                <li>‚úÖ Database persistence verification</li>
                <li>‚úÖ Success/error message display</li>
                <li>‚úÖ Modal close behavior</li>
                <li>‚úÖ Data table refresh after creation</li>
            </ul>

            <div id="summary-status" class="status pending">READY FOR MANUAL TESTING</div>
        </div>
    </div>

    <script>
        let currentTest = 0;
        const totalTests = 4;

        function updateProgress() {
            const progress = (currentTest / totalTests) * 100;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Test Progress: ${currentTest}/${totalTests} completed (${Math.round(progress)}%)`;
        }

        function setTestStatus(testId, status, message = '') {
            const statusElement = document.getElementById(`test${testId}-status`);
            const resultElement = document.getElementById(`test${testId}-result`);

            statusElement.className = `status ${status}`;
            statusElement.textContent = status.toUpperCase();

            if (message) {
                resultElement.innerHTML = `<div style="margin-top: 10px; padding: 10px; background: #f3f4f6; border-radius: 4px;">${message}</div>`;
            }

            if (status === 'passed' || status === 'failed') {
                currentTest++;
                updateProgress();
            }
        }

        function validateBasicInfo() {
            const email = document.getElementById('test-email').value;
            const firstname = document.getElementById('test-firstname').value;
            const lastname = document.getElementById('test-lastname').value;
            const password = document.getElementById('test-password').value;
            const confirmPassword = document.getElementById('test-confirm-password').value;

            let valid = true;
            let errors = [];

            // Email validation
            if (!email) {
                document.getElementById('email-error').textContent = 'Email is required';
                document.getElementById('email-error').style.display = 'block';
                valid = false;
                errors.push('Email is required');
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                document.getElementById('email-error').style.display = 'block';
                valid = false;
                errors.push('Invalid email format');
            } else {
                document.getElementById('email-error').style.display = 'none';
            }

            // Name validation
            if (!firstname) {
                document.getElementById('firstname-error').textContent = 'First name is required';
                document.getElementById('firstname-error').style.display = 'block';
                valid = false;
                errors.push('First name is required');
            } else {
                document.getElementById('firstname-error').style.display = 'none';
            }

            if (!lastname) {
                document.getElementById('lastname-error').textContent = 'Last name is required';
                document.getElementById('lastname-error').style.display = 'block';
                valid = false;
                errors.push('Last name is required');
            } else {
                document.getElementById('lastname-error').style.display = 'none';
            }

            // Password validation
            if (!password) {
                document.getElementById('password-error').textContent = 'Password is required';
                document.getElementById('password-error').style.display = 'block';
                valid = false;
                errors.push('Password is required');
            } else if (password.length < 8) {
                document.getElementById('password-error').textContent = 'Password must be at least 8 characters';
                document.getElementById('password-error').style.display = 'block';
                valid = false;
                errors.push('Password too short');
            } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(password)) {
                document.getElementById('password-error').textContent = 'Password must contain uppercase, lowercase, and number';
                document.getElementById('password-error').style.display = 'block';
                valid = false;
                errors.push('Password complexity requirements not met');
            } else {
                document.getElementById('password-error').style.display = 'none';
            }

            // Confirm password validation
            if (!confirmPassword) {
                document.getElementById('confirm-password-error').textContent = 'Please confirm password';
                document.getElementById('confirm-password-error').style.display = 'block';
                valid = false;
                errors.push('Password confirmation required');
            } else if (password !== confirmPassword) {
                document.getElementById('confirm-password-error').textContent = 'Passwords do not match';
                document.getElementById('confirm-password-error').style.display = 'block';
                valid = false;
                errors.push('Password mismatch');
            } else {
                document.getElementById('confirm-password-error').style.display = 'none';
            }

            if (valid) {
                setTestStatus(2, 'passed', '‚úÖ Basic information validation passed successfully');
            } else {
                setTestStatus(2, 'in-progress', `‚ùå Validation errors found: ${errors.join(', ')}`);
            }
        }

        function validateAdditionalDetails() {
            const phone = document.getElementById('test-phone').value;
            const document = document.getElementById('test-document').value;

            let valid = true;
            let errors = [];

            // Phone validation (optional but if provided must be valid)
            if (phone && !/^\+?[\d\s\-\(\)]+$/.test(phone)) {
                document.getElementById('phone-error').textContent = 'Please enter a valid phone number';
                document.getElementById('phone-error').style.display = 'block';
                valid = false;
                errors.push('Invalid phone format');
            } else {
                document.getElementById('phone-error').style.display = 'none';
            }

            // Document validation (optional but if provided must be valid)
            if (document && document.length < 5) {
                document.getElementById('document-error').textContent = 'Document must be at least 5 characters';
                document.getElementById('document-error').style.display = 'block';
                valid = false;
                errors.push('Document too short');
            } else {
                document.getElementById('document-error').style.display = 'none';
            }

            const message = valid ?
                '‚úÖ Additional details validation passed' :
                `‚ùå Validation errors: ${errors.join(', ')}`;

            return { valid, message };
        }

        function validateSecuritySettings() {
            const userType = document.getElementById('test-usertype').value;
            const securityLevel = document.getElementById('test-security-level').value;

            let valid = true;
            let errors = [];

            if (!userType) {
                valid = false;
                errors.push('User type is required');
            }

            const level = parseInt(securityLevel);
            if (level < 1 || level > 7) {
                valid = false;
                errors.push('Security level must be between 1 and 7');
            }

            const message = valid ?
                '‚úÖ Security settings validation passed' :
                `‚ùå Validation errors: ${errors.join(', ')}`;

            return { valid, message };
        }

        function testEmailValidation() {
            const results = [];

            // Test various email formats
            const testEmails = [
                { email: '', expected: false, desc: 'Empty email' },
                { email: 'invalid', expected: false, desc: 'No @ symbol' },
                { email: 'invalid@', expected: false, desc: 'No domain' },
                { email: 'invalid@domain', expected: false, desc: 'No TLD' },
                { email: 'valid@domain.com', expected: true, desc: 'Valid email' },
                { email: 'test.user+tag@example.co.uk', expected: true, desc: 'Complex valid email' }
            ];

            testEmails.forEach(test => {
                const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(test.email);
                const result = isValid === test.expected ? '‚úÖ' : '‚ùå';
                results.push(`${result} ${test.desc}: "${test.email}"`);
            });

            document.getElementById('validation-results').innerHTML = `
                <h4>Email Validation Test Results:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
            `;
        }

        function testPasswordValidation() {
            const results = [];

            // Test various password formats
            const testPasswords = [
                { pwd: '', expected: false, desc: 'Empty password' },
                { pwd: 'short', expected: false, desc: 'Too short (< 8 chars)' },
                { pwd: 'lowercase', expected: false, desc: 'No uppercase/numbers' },
                { pwd: 'UPPERCASE', expected: false, desc: 'No lowercase/numbers' },
                { pwd: '12345678', expected: false, desc: 'No letters' },
                { pwd: 'Password1', expected: true, desc: 'Valid password' },
                { pwd: 'MySecure123!', expected: true, desc: 'Complex valid password' }
            ];

            testPasswords.forEach(test => {
                const isValid = test.pwd.length >= 8 && /(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(test.pwd);
                const result = isValid === test.expected ? '‚úÖ' : '‚ùå';
                results.push(`${result} ${test.desc}: "${test.pwd}"`);
            });

            document.getElementById('validation-results').innerHTML = `
                <h4>Password Validation Test Results:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
            `;
        }

        function testRequiredFields() {
            const requiredFields = [
                'email', 'password', 'confirmPassword', 'nombre', 'apellido', 'user_type'
            ];

            const results = requiredFields.map(field => {
                return `‚úÖ ${field} - Required field validation implemented`;
            });

            document.getElementById('validation-results').innerHTML = `
                <h4>Required Fields Test Results:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
                <p><strong>Note:</strong> All required fields properly marked with asterisk (*) and have validation rules.</p>
            `;
        }

        function testPhoneValidation() {
            const results = [];

            // Test various phone formats
            const testPhones = [
                { phone: '+1-555-123-4567', expected: true, desc: 'US format with country code' },
                { phone: '(555) 123-4567', expected: true, desc: 'US format with parentheses' },
                { phone: '555.123.4567', expected: false, desc: 'Dots not allowed' },
                { phone: '555-123-4567', expected: true, desc: 'Simple dash format' },
                { phone: '+44 20 7946 0958', expected: true, desc: 'UK format' },
                { phone: 'abc-def-ghij', expected: false, desc: 'Letters not allowed' }
            ];

            testPhones.forEach(test => {
                const isValid = /^\+?[\d\s\-\(\)]+$/.test(test.phone);
                const result = isValid === test.expected ? '‚úÖ' : '‚ùå';
                results.push(`${result} ${test.desc}: "${test.phone}"`);
            });

            document.getElementById('validation-results').innerHTML = `
                <h4>Phone Validation Test Results:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
            `;
        }

        function createTestUser(userType) {
            const timestamp = new Date().getTime();
            const testUser = {
                email: `test.${userType.toLowerCase()}.${timestamp}@example.com`,
                password: 'TestPass123!',
                nombre: `Test${userType}`,
                apellido: `User${timestamp}`,
                user_type: userType,
                security_clearance_level: userType === 'BUYER' ? 1 : userType === 'VENDOR' ? 2 : userType === 'ADMIN' ? 5 : 7,
                telefono: `+1-555-${String(timestamp).slice(-7)}`,
                documento: `DOC${timestamp}`
            };

            document.getElementById('creation-results').innerHTML += `
                <div style="background: #f0f9ff; padding: 10px; margin: 5px 0; border-left: 4px solid #3b82f6; border-radius: 4px;">
                    <h5>Test ${userType} User Created:</h5>
                    <p><strong>Email:</strong> ${testUser.email}</p>
                    <p><strong>Password:</strong> ${testUser.password}</p>
                    <p><strong>Name:</strong> ${testUser.nombre} ${testUser.apellido}</p>
                    <p><strong>Type:</strong> ${testUser.user_type}</p>
                    <p><strong>Security Level:</strong> ${testUser.security_clearance_level}</p>
                    <p><strong>Phone:</strong> ${testUser.telefono}</p>
                    <p><strong>Document:</strong> ${testUser.documento}</p>
                    <p style="color: #3b82f6;"><strong>Status:</strong> Ready for manual testing in admin system</p>
                </div>
            `;
        }

        // Initialize progress
        updateProgress();

        // Set initial test status
        setTimeout(() => {
            setTestStatus(1, 'in-progress', 'üîç Navigate to http://192.168.1.137:5175 and test modal opening functionality manually');
        }, 1000);
    </script>
</body>
</html>